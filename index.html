<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—É—Å —Ç–∏–ª–∏ ‚Äî 150 –æ—Ç + —Å–∏—Ñ–∞—Ç</title>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for(var j=0;j<document.scripts.length;j++){if(document.scripts[j].src===r){return;}}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");

        ym(106526217, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/106526217" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a28;
            --bg-elevated: #242438;
            --accent-1: #6366f1;
            --accent-2: #8b5cf6;
            --accent-3: #a855f7;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --text-1: #f1f5f9;
            --text-2: #94a3b8;
            --text-3: #64748b;
            --border: rgba(255,255,255,0.06);
            --glow: rgba(99,102,241,0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-1);
            min-height: 100vh;
            line-height: 1.5;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, var(--glow), transparent),
                radial-gradient(ellipse 60% 40% at 100% 100%, rgba(139,92,246,0.08), transparent);
            pointer-events: none;
        }

        /* Header */
        .header {
            background: rgba(18,18,26,0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-inner { max-width: 900px; margin: 0 auto; }
        .header h1 {
            font-size: 1.4em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #fff 0%, var(--accent-1) 50%, var(--accent-2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stats-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 14px;
        }
        .stat-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 8px 14px;
            border-radius: 100px;
            font-size: 0.85em;
            font-weight: 500;
        }
        .stat-chip .val { color: var(--accent-1); font-weight: 600; }
        .progress-track {
            height: 6px;
            background: var(--bg-card);
            border-radius: 100px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-1), var(--accent-2), var(--accent-3));
            border-radius: 100px;
            transition: width 0.4s ease;
            position: relative;
        }
        .progress-bar::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 2s infinite;
        }
        @keyframes shine {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        /* Navigation */
        .nav {
            display: flex;
            justify-content: center;
            gap: 6px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }
        .nav-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            background: transparent;
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.875em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-btn:hover { background: var(--bg-card); color: var(--text-1); }
        .nav-btn.active {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            color: #fff;
            box-shadow: 0 4px 20px var(--glow);
        }

        /* Main Container */
        .main { max-width: 850px; margin: 0 auto; padding: 20px 16px; position: relative; z-index: 1; }

        /* Selector */
        .selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .arrow-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-1);
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s;
            display: grid;
            place-items: center;
        }
        .arrow-btn:hover:not(:disabled) {
            background: var(--accent-1);
            border-color: var(--accent-1);
            transform: scale(1.05);
        }
        .arrow-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .counter {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
        }
        .counter .cur { color: var(--accent-1); }
        .goto {
            width: 60px;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-1);
            font-family: inherit;
            font-size: 0.9em;
            text-align: center;
            transition: all 0.2s;
        }
        .goto:focus { outline: none; border-color: var(--accent-1); box-shadow: 0 0 0 3px var(--glow); }

        /* Adjective Pills */
        .adj-pills {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .adj-pill {
            padding: 10px 18px;
            border: 1px solid var(--border);
            border-radius: 100px;
            background: var(--bg-card);
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .adj-pill:hover { border-color: var(--accent-1); color: var(--text-1); }
        .adj-pill.active {
            background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(139,92,246,0.15));
            border-color: var(--accent-1);
            color: var(--text-1);
        }

        /* Card */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 40px rgba(0,0,0,0.3), 0 0 60px var(--glow);
        }
        .card-head {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            padding: 28px 24px;
            text-align: center;
            position: relative;
        }
        .card-head::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .phrase { font-size: 2em; font-weight: 700; margin-bottom: 12px; position: relative; text-shadow: 0 2px 20px rgba(0,0,0,0.2); }
        .badges { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; position: relative; }
        .badge {
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 0.85em;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        .g-m { background: rgba(59,130,246,0.85); }
        .g-f { background: rgba(236,72,153,0.85); }
        .g-n { background: rgba(34,197,94,0.85); }
        .g-pl { background: rgba(168,85,247,0.85); }
        .uz-badge { background: rgba(255,255,255,0.2); }

        /* Cases */
        .cases { padding: 16px; }
        .case-row {
            display: grid;
            grid-template-columns: 130px 1fr 1fr;
            gap: 10px;
            padding: 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 14px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .case-row:hover { transform: translateX(4px); border-color: rgba(99,102,241,0.3); }
        .case-row:last-child { margin-bottom: 0; }
        @media (max-width: 600px) {
            .case-row { grid-template-columns: 1fr; text-align: center; }
            .case-lbl { border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 8px; }
        }
        .case-lbl { display: flex; flex-direction: column; justify-content: center; }
        .case-name { color: var(--accent-1); font-weight: 600; font-size: 0.95em; }
        .case-q { color: var(--text-3); font-size: 0.8em; }
        .form-cell {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 12px;
        }
        .form-cell .lbl { font-size: 0.7em; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
        .form-cell .ru { font-weight: 600; font-size: 0.95em; margin-bottom: 4px; }
        .form-cell .uz { color: var(--success); font-size: 0.85em; }

        /* Hints */
        .hints { text-align: center; padding: 14px; color: var(--text-3); font-size: 0.8em; }
        kbd { background: var(--bg-card); border: 1px solid var(--border); padding: 3px 8px; border-radius: 6px; font-family: inherit; margin: 0 2px; }

        /* Quiz */
        .quiz { display: none; padding: 16px; }
        .quiz.active { display: block; }
        .quiz-modes { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .mode-btn {
            padding: 10px 18px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .mode-btn:hover { border-color: var(--accent-1); color: var(--text-1); }
        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-color: transparent;
            color: #fff;
        }
        .quiz-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px 24px;
            text-align: center;
        }
        .q-word { font-size: 1.8em; font-weight: 700; margin-bottom: 10px; }
        .q-case { color: var(--accent-1); font-weight: 500; margin-bottom: 8px; }
        .q-hint {
            display: inline-block;
            color: var(--success);
            background: rgba(34,197,94,0.1);
            border: 1px solid rgba(34,197,94,0.2);
            padding: 8px 18px;
            border-radius: 100px;
            margin-bottom: 8px;
        }
        .q-num { color: var(--text-3); font-size: 0.9em; margin-bottom: 16px; }
        .q-input {
            width: 100%;
            max-width: 320px;
            padding: 14px 20px;
            border: 1px solid var(--border);
            border-radius: 14px;
            background: var(--bg-secondary);
            color: var(--text-1);
            font-family: inherit;
            font-size: 1.1em;
            text-align: center;
            transition: all 0.2s;
        }
        .q-input:focus { outline: none; border-color: var(--accent-1); box-shadow: 0 0 0 4px var(--glow); }
        .q-btns { margin-top: 16px; display: flex; justify-content: center; gap: 10px; }
        .q-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .q-check { background: linear-gradient(135deg, var(--success), #16a34a); color: #fff; }
        .q-check:hover { transform: scale(1.03); box-shadow: 0 4px 20px rgba(34,197,94,0.3); }
        .q-skip { background: var(--bg-elevated); color: var(--text-2); border: 1px solid var(--border); }
        .q-skip:hover { color: var(--text-1); }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 16px auto; max-width: 420px; }
        @media (max-width: 480px) { .options { grid-template-columns: 1fr; } }
        .opt-btn {
            padding: 14px 18px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-elevated);
            color: var(--text-1);
            font-family: inherit;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .opt-btn:hover:not(:disabled) { border-color: var(--accent-1); transform: translateY(-2px); }
        .opt-btn.correct { border-color: var(--success); background: rgba(34,197,94,0.15); }
        .opt-btn.wrong { border-color: var(--danger); background: rgba(239,68,68,0.15); animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }
        .opt-btn:disabled { cursor: not-allowed; opacity: 0.7; }
        .result { padding: 16px; border-radius: 12px; margin-top: 16px; font-weight: 500; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
        .result.ok { background: rgba(34,197,94,0.12); border: 1px solid var(--success); color: var(--success); }
        .result.no { background: rgba(239,68,68,0.12); border: 1px solid var(--danger); color: var(--danger); }
        .answer { color: var(--accent-1); font-weight: 600; margin-top: 8px; font-size: 1.1em; }

        /* Sentences */
        .sentences { display: none; padding: 16px; }
        .sentences.active { display: block; }
        .sent-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px 24px;
            text-align: center;
        }
        .sent-text {
            font-size: 1.4em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--text-1);
        }
        .sent-blank {
            display: inline-block;
            min-width: 180px;
            border-bottom: 3px dashed var(--accent-1);
            color: var(--accent-1);
            font-weight: 700;
            padding: 4px 8px;
            margin: 0 4px;
        }
        .sent-hint {
            color: var(--text-3);
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        .sent-hint strong { color: var(--warning); }
        .sent-options { display: flex; flex-direction: column; gap: 10px; max-width: 500px; margin: 0 auto; }
        .sent-opt {
            padding: 16px 20px;
            border: 1px solid var(--border);
            border-radius: 14px;
            background: var(--bg-elevated);
            color: var(--text-1);
            font-family: inherit;
            font-size: 1.05em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        .sent-opt:hover:not(:disabled) { border-color: var(--accent-1); transform: translateX(4px); background: var(--bg-card); }
        .sent-opt.correct { border-color: var(--success); background: rgba(34,197,94,0.15); }
        .sent-opt.wrong { border-color: var(--danger); background: rgba(239,68,68,0.15); animation: shake 0.4s; }
        .sent-opt:disabled { cursor: not-allowed; opacity: 0.7; }
        .sent-score { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); color: var(--text-2); font-size: 0.9em; }
        .sent-score .val { color: var(--accent-1); font-weight: 600; }

        /* List */
        .list { display: none; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        .list.active { display: grid; }
        .search-wrap { grid-column: 1/-1; text-align: center; margin-bottom: 6px; }
        .search-input {
            width: 100%;
            max-width: 360px;
            padding: 12px 20px;
            border: 1px solid var(--border);
            border-radius: 100px;
            background: var(--bg-card);
            color: var(--text-1);
            font-family: inherit;
            font-size: 0.95em;
            transition: all 0.2s;
        }
        .search-input:focus { outline: none; border-color: var(--accent-1); box-shadow: 0 0 0 4px var(--glow); }
        .list-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 14px 10px;
            border-radius: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .list-card:hover { transform: translateY(-4px); border-color: var(--accent-1); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        .list-card.done { background: rgba(34,197,94,0.12); border-color: var(--success); }
        .list-card .num { font-size: 0.75em; color: var(--text-3); margin-bottom: 4px; }
        .list-card .word { font-weight: 600; margin-bottom: 4px; }
        .list-card .meaning { font-size: 0.85em; color: var(--success); }

        /* Verbs Section */
        .verbs-section { display: none; }
        .verbs-section.active { display: block; }
        .verbs-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }
        .verb-tab {
            padding: 10px 18px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .verb-tab:hover { border-color: var(--accent-1); color: var(--text-1); }
        .verb-tab.active {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-color: transparent;
            color: #fff;
        }
        .aspect-pills {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }
        .aspect-pill {
            padding: 10px 18px;
            border: 1px solid var(--border);
            border-radius: 100px;
            background: var(--bg-card);
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .aspect-pill:hover { border-color: var(--accent-1); color: var(--text-1); }
        .aspect-pill.active {
            background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(139,92,246,0.15));
            border-color: var(--accent-1);
            color: var(--text-1);
        }
        .verb-pair {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .verb-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            padding: 12px 20px;
            border-radius: 12px;
            text-align: center;
        }
        .verb-item.active { border-color: var(--accent-1); background: rgba(99,102,241,0.1); }
        .verb-item .aspect { font-size: 0.75em; color: var(--text-3); margin-bottom: 4px; }
        .verb-item .verb { font-size: 1.2em; font-weight: 600; }
        .conj-table {
            width: 100%;
            margin-top: 16px;
        }
        .conj-row {
            display: grid;
            grid-template-columns: 80px 1fr 1fr 1fr;
            gap: 10px;
            padding: 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 8px;
        }
        @media (max-width: 600px) {
            .conj-row { grid-template-columns: 1fr; text-align: center; }
            .conj-row > div { padding: 8px 0; border-bottom: 1px solid var(--border); }
            .conj-row > div:last-child { border-bottom: none; }
        }
        .conj-row .pronoun { color: var(--accent-1); font-weight: 600; display: flex; align-items: center; }
        .conj-row .tense-cell {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
        }
        .conj-row .tense-cell .lbl { font-size: 0.7em; color: var(--text-3); text-transform: uppercase; margin-bottom: 2px; }
        .conj-row .tense-cell .form { font-weight: 500; }
        .conj-row .tense-cell .form.na { color: var(--text-3); font-style: italic; }

        /* Grammar Section */
        .grammar-section { display: none; }
        .grammar-section.active { display: block; }
        .grammar-tabs {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .gram-tab {
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .gram-tab:hover { border-color: var(--accent-1); color: var(--text-1); }
        .gram-tab.active {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-color: transparent;
            color: #fff;
        }
        .gram-header {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.3), 0 0 60px var(--glow);
        }
        .gram-header-top {
            padding: 28px 24px;
            text-align: center;
            position: relative;
        }
        .gram-header-top::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .gram-case-name {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            text-shadow: 0 2px 20px rgba(0,0,0,0.2);
        }
        .gram-case-question {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
        }
        .gram-case-uz {
            margin-top: 8px;
            opacity: 0.9;
            font-size: 0.95em;
            position: relative;
            color: var(--success);
        }
        .gram-header-body { padding: 24px; }
        .gram-explanation {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
        }
        .gram-explanation h3 {
            color: var(--accent-1);
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: 600;
        }
        .gram-explanation p {
            line-height: 1.7;
            color: var(--text-2);
            margin-bottom: 8px;
        }
        .gram-explanation .uz-text { color: var(--success); }
        .gram-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .gram-section h3 {
            color: var(--accent-1);
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        .use-case-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 14px;
            transition: all 0.2s;
        }
        .use-case-item:hover { transform: translateX(4px); border-color: rgba(99,102,241,0.3); }
        .use-case-title { font-weight: 600; margin-bottom: 6px; color: var(--text-1); }
        .use-case-title-uz { color: var(--success); font-size: 0.9em; margin-bottom: 10px; }
        .use-case-example {
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-1);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
        }
        .use-case-example .ru { font-weight: 500; margin-bottom: 4px; }
        .use-case-example .uz { color: var(--text-3); font-size: 0.9em; }
        .use-case-example .hl { color: var(--accent-1); font-weight: 700; background: rgba(99,102,241,0.15); padding: 1px 5px; border-radius: 4px; }
        .ending-row {
            display: grid;
            grid-template-columns: 100px 1fr 1fr;
            gap: 10px;
            padding: 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 14px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .ending-row:hover { transform: translateX(4px); border-color: rgba(99,102,241,0.3); }
        .ending-gender {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--accent-1);
            font-size: 0.9em;
        }
        .ending-cell {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }
        .ending-cell .lbl { font-size: 0.75em; color: var(--text-3); text-transform: uppercase; margin-bottom: 6px; }
        .ending-cell .val { font-weight: 600; font-size: 1em; color: var(--text-1); margin-bottom: 6px; }
        .ending-cell .exs { font-size: 0.82em; color: var(--success); line-height: 1.5; }
        .adj-ending-section { margin-top: 16px; }
        .adj-ending-section h4 { color: var(--accent-2); font-size: 1em; margin-bottom: 12px; text-align: center; }
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 14px;
        }
        .example-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 16px;
            transition: all 0.2s;
        }
        .example-card:hover { transform: translateY(-2px); border-color: var(--accent-1); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        .example-card .ru { font-weight: 500; margin-bottom: 8px; line-height: 1.5; }
        .example-card .hl { color: var(--accent-1); font-weight: 700; background: rgba(99,102,241,0.15); padding: 1px 5px; border-radius: 4px; }
        .example-card .uz { color: var(--success); font-size: 0.9em; }
        .mistake-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 14px;
        }
        .mistake-wrong {
            padding: 10px 14px;
            background: rgba(239,68,68,0.12);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 8px;
            margin-bottom: 8px;
            color: var(--danger);
        }
        .mistake-correct {
            padding: 10px 14px;
            background: rgba(34,197,94,0.12);
            border: 1px solid rgba(34,197,94,0.3);
            border-radius: 8px;
            margin-bottom: 10px;
            color: var(--success);
        }
        .mistake-explain { font-size: 0.9em; color: var(--text-2); line-height: 1.6; }
        .mistake-explain .uz-text { color: var(--success); display: block; margin-top: 4px; }
        .gram-nav {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        .gram-nav-btn {
            padding: 12px 24px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-2);
            font-family: inherit;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .gram-nav-btn:hover { border-color: var(--accent-1); color: var(--text-1); background: var(--bg-elevated); }
        .gram-nav-btn:disabled { opacity: 0.3; cursor: default; }
        @media (max-width: 700px) {
            .ending-row { grid-template-columns: 1fr; text-align: center; }
            .ending-gender { justify-content: center; }
            .gram-case-name { font-size: 1.5em; }
            .grammar-tabs { gap: 4px; }
            .gram-tab { padding: 8px 12px; font-size: 0.8em; }
            .examples-grid { grid-template-columns: 1fr; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--bg-elevated); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-1); }
    </style>
</head>
<body>
<div class="header">
    <div class="header-inner">
        <h1>üá∑üá∫ –†—É—Å —Ç–∏–ª–∏ ‚Äî 150 —Ç–∞ –æ—Ç + —Å–∏—Ñ–∞—Ç –ø–∞–¥–µ–∂–ª–∞—Ä–∏</h1>
        <div class="stats-row">
            <div class="stat-chip">üìö –ñ–∞–º–∏: <span class="val" id="total">150</span></div>
            <div class="stat-chip">‚úÖ –é—Ä–≥–∞–Ω–∏–ª–¥–∏: <span class="val" id="done">0</span></div>
            <div class="stat-chip">üéØ –ë–∞–ª–ª: <span class="val"><span id="score">0</span>/<span id="tries">0</span></span></div>
        </div>
        <div class="progress-track"><div class="progress-bar" id="prog" style="width:0%"></div></div>
    </div>
</div>
<div class="nav">
    <button class="nav-btn active" onclick="mode('learn')">üìñ –é—Ä–≥–∞–Ω–∏—à</button>
    <button class="nav-btn" onclick="mode('quiz')">üéØ –¢–µ—Å—Ç</button>
    <button class="nav-btn" onclick="mode('sentences')">üìù –ì–∞–ø–ª–∞—Ä</button>
    <button class="nav-btn" onclick="mode('list')">üìã –†—û–π—Ö–∞—Ç</button>
    <button class="nav-btn" onclick="mode('verbs')">üî§ –§–µ—ä–ª–∞—Ä</button>
    <button class="nav-btn" onclick="mode('grammar')">üìó –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</button>
    <button class="nav-btn" onclick="markDone()">‚úÖ –é—Ä–≥–∞–Ω–¥–∏–º</button>
    <button class="nav-btn" onclick="shuffle()">üîÄ –ê—Ä–∞–ª–∞—à</button>
</div>
<div class="main">
    <div id="learn">
        <div class="selector">
            <button class="arrow-btn" onclick="prevWord()">‚Üê</button>
            <div class="counter"><span class="cur" id="curWord">1</span> / <span id="totalWords">150</span></div>
            <button class="arrow-btn" onclick="nextWord()">‚Üí</button>
            <input type="number" class="goto" min="1" max="150" onchange="goToNum(this.value)" placeholder="#">
        </div>
        <div class="adj-pills" id="adjSelector"></div>
        <div class="card" id="card"></div>
        <div class="hints"><kbd>‚Üê</kbd><kbd>‚Üí</kbd> –Ω–∞–≤–∏–≥–∞—Ü–∏—è ¬∑ <kbd>1</kbd><kbd>2</kbd><kbd>3</kbd> —Å–∏—Ñ–∞—Ç ¬∑ <kbd>Space</kbd> —û—Ä–≥–∞–Ω–¥–∏–º</div>
    </div>
    <div class="quiz" id="quiz">
        <div class="quiz-modes">
            <button class="mode-btn active" onclick="setQuizType('write')" id="qtWrite">‚úçÔ∏è –Å–∑–∏—à</button>
            <button class="mode-btn" onclick="setQuizType('uz2ru')" id="qtUzRu">üá∫üáø ‚Üí üá∑üá∫</button>
            <button class="mode-btn" onclick="setQuizType('ru2uz')" id="qtRuUz">üá∑üá∫ ‚Üí üá∫üáø</button>
        </div>
        <div class="quiz-box">
            <div class="q-word" id="qWord"></div>
            <div class="q-case" id="qCase"></div>
            <div class="q-hint" id="qHint"></div>
            <div class="q-num" id="qNum"></div>
            <div id="writeMode">
                <input type="text" class="q-input" id="qInput" placeholder="–ñ–∞–≤–æ–±–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥..." autocomplete="off">
                <div class="q-btns">
                    <button class="q-btn q-check" onclick="checkWrite()">‚úì –¢–µ–∫—à–∏—Ä–∏—à</button>
                    <button class="q-btn q-skip" onclick="skipQ()">‚Üí –ö–µ–π–∏–Ω–≥–∏</button>
                </div>
            </div>
            <div id="choiceMode" style="display:none"><div class="options" id="options"></div></div>
            <div class="result" id="qRes" style="display:none"></div>
        </div>
    </div>
    <div class="list" id="list"></div>
    <div class="sentences" id="sentences">
        <div class="sent-box">
            <div class="sent-text" id="sentText"></div>
            <div class="sent-hint" id="sentHint"></div>
            <div class="sent-options" id="sentOptions"></div>
            <div class="result" id="sentRes" style="display:none"></div>
            <div class="sent-score">–ì–∞–ø–ª–∞—Ä –º–∞—à“õ–∏: <span class="val"><span id="sentScore">0</span>/<span id="sentTries">0</span></span></div>
        </div>
    </div>
    <!-- Verbs Section -->
    <div class="verbs-section" id="verbs">
        <div class="verbs-tabs">
            <button class="verb-tab active" onclick="setVerbMode('learn')" id="vLearn">üìñ –é—Ä–≥–∞–Ω–∏—à</button>
            <button class="verb-tab" onclick="setVerbMode('quiz')" id="vQuiz">üéØ –¢–µ—Å—Ç</button>
            <button class="verb-tab" onclick="setVerbMode('sentences')" id="vSent">üìù –ì–∞–ø–ª–∞—Ä</button>
            <button class="verb-tab" onclick="setVerbMode('list')" id="vList">üìã –†—û–π—Ö–∞—Ç</button>
        </div>
        <div id="verbLearn">
            <div class="selector">
                <button class="arrow-btn" onclick="prevVerb()">‚Üê</button>
                <div class="counter"><span class="cur" id="curVerb">1</span> / <span id="totalVerbs">20</span></div>
                <button class="arrow-btn" onclick="nextVerb()">‚Üí</button>
                <input type="number" class="goto" min="1" max="20" onchange="goToVerb(this.value)" placeholder="#">
            </div>
            <div class="aspect-pills">
                <button class="aspect-pill active" onclick="setAspect('nsv')" id="aspNsv">–ù–°–í (—Ç—É–≥–∞–ª–ª–∞–Ω–º–∞–≥–∞–Ω)</button>
                <button class="aspect-pill" onclick="setAspect('sv')" id="aspSv">–°–í (—Ç—É–≥–∞–ª–ª–∞–≥–∞–Ω)</button>
            </div>
            <div class="card" id="verbCard"></div>
            <div class="hints"><kbd>‚Üê</kbd><kbd>‚Üí</kbd> –Ω–∞–≤–∏–≥–∞—Ü–∏—è ¬∑ <kbd>N</kbd> –ù–°–í ¬∑ <kbd>S</kbd> –°–í</div>
        </div>
        <div id="verbQuiz" style="display:none">
            <div class="quiz-modes">
                <button class="mode-btn active" onclick="setVerbQuizType('conj')" id="vqConj">üìù –¢—É—Å–ª–∞–Ω–∏—à</button>
                <button class="mode-btn" onclick="setVerbQuizType('uz2ru')" id="vqUzRu">üá∫üáø ‚Üí üá∑üá∫</button>
                <button class="mode-btn" onclick="setVerbQuizType('ru2uz')" id="vqRuUz">üá∑üá∫ ‚Üí üá∫üáø</button>
            </div>
            <div class="quiz-box">
                <div class="q-word" id="vqWord"></div>
                <div class="q-case" id="vqInfo"></div>
                <div class="q-hint" id="vqHint"></div>
                <div id="vWriteMode">
                    <input type="text" class="q-input" id="vqInput" placeholder="–ñ–∞–≤–æ–±–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥..." autocomplete="off">
                    <div class="q-btns">
                        <button class="q-btn q-check" onclick="checkVerbWrite()">‚úì –¢–µ–∫—à–∏—Ä–∏—à</button>
                        <button class="q-btn q-skip" onclick="skipVerbQ()">‚Üí –ö–µ–π–∏–Ω–≥–∏</button>
                    </div>
                </div>
                <div id="vChoiceMode" style="display:none"><div class="options" id="vOptions"></div></div>
                <div class="result" id="vqRes" style="display:none"></div>
                <div class="sent-score">–§–µ—ä–ª –º–∞—à“õ–∏: <span class="val"><span id="verbScore">0</span>/<span id="verbTries">0</span></span></div>
            </div>
        </div>
        <div id="verbList" style="display:none" class="list"></div>
        <div id="verbSentences" style="display:none">
            <div class="sent-box">
                <div class="sent-text" id="vSentText"></div>
                <div class="sent-hint" id="vSentHint"></div>
                <div class="sent-options" id="vSentOptions"></div>
                <div class="result" id="vSentRes" style="display:none"></div>
                <div class="sent-score">–§–µ—ä–ª –≥–∞–ø–ª–∞—Ä –º–∞—à“õ–∏: <span class="val"><span id="vSentScore">0</span>/<span id="vSentTries">0</span></span></div>
            </div>
        </div>
    </div>
    <div class="grammar-section" id="grammar">
        <div class="grammar-tabs" id="gramTabs"></div>
        <div id="gramContent"></div>
        <div class="gram-nav">
            <button class="gram-nav-btn" id="gramPrev" onclick="prevCase()">‚Üê –û–ª–¥–∏–Ω–≥–∏</button>
            <button class="gram-nav-btn" id="gramNext" onclick="nextCase()">–ö–µ–π–∏–Ω–≥–∏ ‚Üí</button>
        </div>
    </div>
</div>
<script src="data_150.js?v=3"></script>
<script src="sentences.js?v=3"></script>
<script src="verbs.js?v=1"></script>
<script src="verb_sentences.js?v=1"></script>
<script src="grammatika.js?v=1"></script>
<script>
const CASES=[{ru:"–ò–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π",q:"–∫—Ç–æ? —á—Ç–æ?"},{ru:"–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π",q:"–∫–æ–≥–æ? —á–µ–≥–æ?"},{ru:"–î–∞—Ç–µ–ª—å–Ω—ã–π",q:"–∫–æ–º—É? —á–µ–º—É?"},{ru:"–í–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π",q:"–∫–æ–≥–æ? —á—Ç–æ?"},{ru:"–¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π",q:"–∫–µ–º? —á–µ–º?"},{ru:"–ü—Ä–µ–¥–ª–æ–∂–Ω—ã–π",q:"–æ –∫–æ–º? –æ —á—ë–º?"}];
const UZ_SUFFIX=["","–Ω–∏–Ω–≥","–≥–∞","–Ω–∏"," –±–∏–ª–∞–Ω"," “≥–∞“õ–∏–¥–∞"];
const GENDER_CLASS={–º:"g-m",–∂:"g-f",—Å—Ä:"g-n",–º–Ω:"g-pl"};
const GENDER_NAME={–º:"–º—É–∂.",–∂:"–∂–µ–Ω.",—Å—Ä:"—Å—Ä.",–º–Ω:"–º–Ω."};
let wordIdx=0,adjIdx=0,learned=new Set(),score=0,tries=0,quizType="write",currentAnswer="",currentUzAnswer="";
let wordOrder=[...Array(DATA.length).keys()];
function getUzPhrase(n,a,s){return a+" "+n+s}
function renderAdjBtns(){const d=DATA[wordOrder[wordIdx]];document.getElementById("adjSelector").innerHTML=d[4].map((a,i)=>`<button class="adj-pill ${i===adjIdx?'active':''}" onclick="setAdj(${i})">${a[0]} <span style="opacity:0.7">(${a[1]})</span></button>`).join("")}
function render(){
    const d=DATA[wordOrder[wordIdx]];const[noun,gender,nUz,nUzPl,adjs]=d;const[adj,adjUz,forms]=adjs[adjIdx];const[sgForms,plForms]=forms;
    let h=`<div class="card-head"><div class="phrase">${adj} ${noun}</div><div class="badges"><span class="badge ${GENDER_CLASS[gender]}">${GENDER_NAME[gender]}</span><span class="badge uz-badge">üá∫üáø ${adjUz} ${nUz}</span></div></div><div class="cases">`;
    for(let c=0;c<6;c++){
        const sg=sgForms[c],pl=plForms[c];
        const uzSg=nUz&&nUz!=="‚Äî"?getUzPhrase(nUz,adjUz,UZ_SUFFIX[c]):"‚Äî";
        const uzPl=nUzPl&&nUzPl!=="‚Äî"?getUzPhrase(nUzPl,adjUz,UZ_SUFFIX[c]):"‚Äî";
        h+=`<div class="case-row"><div class="case-lbl"><div class="case-name">${CASES[c].ru}</div><div class="case-q">${CASES[c].q}</div></div><div class="form-cell"><div class="lbl">–µ–¥.—á.</div><div class="ru">${sg}</div><div class="uz">${uzSg}</div></div><div class="form-cell"><div class="lbl">–º–Ω.—á.</div><div class="ru">${pl}</div><div class="uz">${uzPl}</div></div></div>`;
    }
    h+=`</div>`;document.getElementById("card").innerHTML=h;document.getElementById("curWord").textContent=wordIdx+1;document.getElementById("totalWords").textContent=DATA.length;renderAdjBtns()
}
function setAdj(i){adjIdx=i;render()}
function prevWord(){if(wordIdx>0){wordIdx--;adjIdx=0;render()}}
function nextWord(){if(wordIdx<DATA.length-1){wordIdx++;adjIdx=0;render()}}
function goToNum(v){const n=parseInt(v);if(n>=1&&n<=DATA.length){wordIdx=n-1;adjIdx=0;render()}}
function markDone(){learned.add(wordOrder[wordIdx]);updateStats();if(wordIdx<DATA.length-1)nextWord()}
function shuffle(){for(let i=wordOrder.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[wordOrder[i],wordOrder[j]]=[wordOrder[j],wordOrder[i]]}wordIdx=0;adjIdx=0;render()}
function updateStats(){document.getElementById("done").textContent=learned.size;document.getElementById("score").textContent=score;document.getElementById("tries").textContent=tries;document.getElementById("total").textContent=DATA.length;document.getElementById("prog").style.width=(learned.size/DATA.length*100)+"%"}
function mode(m){
    const modeIdx = {learn:0, quiz:1, sentences:2, list:3, verbs:4, grammar:5};
    document.querySelectorAll(".nav-btn").forEach((b,i)=>b.classList.toggle("active",i===modeIdx[m]));
    document.getElementById("learn").style.display=m==="learn"?"block":"none";
    document.getElementById("quiz").classList.toggle("active",m==="quiz");
    document.getElementById("sentences").classList.toggle("active",m==="sentences");
    document.getElementById("list").classList.toggle("active",m==="list");
    document.getElementById("verbs").classList.toggle("active",m==="verbs");
    document.getElementById("grammar").classList.toggle("active",m==="grammar");
    if(m==="quiz")genQ();if(m==="sentences")genSentence();if(m==="list")renderList();if(m==="verbs")renderVerb();if(m==="grammar")renderGrammar();
}
function setQuizType(t){
    quizType=t;
    document.getElementById("qtWrite").classList.toggle("active",t==="write");
    document.getElementById("qtUzRu").classList.toggle("active",t==="uz2ru");
    document.getElementById("qtRuUz").classList.toggle("active",t==="ru2uz");
    document.getElementById("writeMode").style.display=t==="write"?"block":"none";
    document.getElementById("choiceMode").style.display=t!=="write"?"block":"none";
    genQ()
}
function genQ(){
    const wI=Math.floor(Math.random()*DATA.length),aI=Math.floor(Math.random()*3),cI=Math.floor(Math.random()*6),pl=Math.random()>0.5;
    const d=DATA[wI],[noun,gender,nUz,nUzPl,adjs]=d,[adj,adjUz,forms]=adjs[aI],ruForm=forms[pl?1:0][cI];
    if(ruForm==="‚Äî"){genQ();return}
    const nounUz=pl?nUzPl:nUz;if(!nounUz||nounUz==="‚Äî"){genQ();return}
    const uzForm=getUzPhrase(nounUz,adjUz,UZ_SUFFIX[cI]);currentAnswer=ruForm;currentUzAnswer=uzForm;
    const basePhrase=adj+" "+noun,numTxt=pl?"–ö—û–ø–ª–∏–∫ (–º–Ω.—á.)":"–ë–∏—Ä–ª–∏–∫ (–µ–¥.—á.)";
    document.getElementById("qRes").style.display="none";
    if(quizType==="write"){
        document.getElementById("qWord").textContent=basePhrase;
        document.getElementById("qCase").textContent=CASES[cI].ru+" ("+CASES[cI].q+")";
        document.getElementById("qHint").textContent="üá∫üáø "+uzForm;
        document.getElementById("qHint").style.display="inline-block";
        document.getElementById("qNum").textContent=numTxt;
        document.getElementById("qInput").value="";document.getElementById("qInput").focus()
    }else if(quizType==="uz2ru"){
        document.getElementById("qWord").textContent="üá∫üáø "+uzForm;
        document.getElementById("qCase").textContent=basePhrase+" ‚Äî "+CASES[cI].ru;
        document.getElementById("qHint").style.display="none";
        document.getElementById("qNum").textContent=numTxt+" ‚Äî –¢—û“ì—Ä–∏ —à–∞–∫–ª–Ω–∏ —Ç–æ–ø–∏–Ω–≥";
        genOpts("ru",ruForm,cI,pl,wI,aI)
    }else{
        document.getElementById("qWord").textContent="üá∑üá∫ "+ruForm;
        document.getElementById("qCase").textContent=basePhrase+" ‚Äî "+CASES[cI].ru;
        document.getElementById("qHint").style.display="none";
        document.getElementById("qNum").textContent=numTxt+" ‚Äî –¢–∞—Ä–∂–∏–º–∞–Ω–∏ —Ç–æ–ø–∏–Ω–≥";
        genOpts("uz",uzForm,cI,pl,wI,aI)
    }
}
function genOpts(lang,correct,cI,pl,wI,aI){
    const d=DATA[wI],[noun,gender,nUz,nUzPl,adjs]=d,[adj,adjUz,forms]=adjs[aI];
    const opts=[correct],all=[];
    for(let c=0;c<6;c++){
        if(c===cI)continue;let form;
        if(lang==="ru"){form=forms[pl?1:0][c]}else{const nU=pl?nUzPl:nUz;if(!nU||nU==="‚Äî")continue;form=getUzPhrase(nU,adjUz,UZ_SUFFIX[c])}
        if(form&&form!=="‚Äî"&&form!==correct&&!all.includes(form))all.push(form)
    }
    while(opts.length<4&&all.length>0){const i=Math.floor(Math.random()*all.length);opts.push(all.splice(i,1)[0])}
    for(let i=opts.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[opts[i],opts[j]]=[opts[j],opts[i]]}
    document.getElementById("options").innerHTML=opts.map(o=>`<button class="opt-btn" onclick="checkOpt(this,'${o.replace(/'/g,"\\'")}','${correct.replace(/'/g,"\\'")}')">${o}</button>`).join("")
}
function checkOpt(btn,sel,corr){
    document.querySelectorAll(".opt-btn").forEach(b=>{b.disabled=true;if(b.textContent===corr)b.classList.add("correct")});
    tries++;const res=document.getElementById("qRes");
    if(sel===corr){score++;btn.classList.add("correct");res.className="result ok";res.innerHTML="‚úÖ –¢—û“ì—Ä–∏!"}
    else{btn.classList.add("wrong");res.className="result no";res.innerHTML=`‚ùå<div class="answer">${corr}</div>`}
    res.style.display="block";updateStats();setTimeout(genQ,3000)
}
function checkWrite(){
    const user=document.getElementById("qInput").value.trim().toLowerCase(),corr=currentAnswer.toLowerCase();
    tries++;const res=document.getElementById("qRes");
    if(user===corr){score++;res.className="result ok";res.innerHTML="‚úÖ –¢—û“ì—Ä–∏!"}
    else{res.className="result no";res.innerHTML=`‚ùå<div class="answer">${currentAnswer}</div>`}
    res.style.display="block";updateStats();setTimeout(genQ,3000)
}
function skipQ(){
    const res=document.getElementById("qRes");
    res.className="result no";res.innerHTML=`<div class="answer">${currentAnswer}</div>`;
    res.style.display="block";tries++;updateStats();setTimeout(genQ,3000)
}
function renderList(){
    let h=`<div class="search-wrap"><input type="text" class="search-input" id="searchInput" placeholder="üîç “ö–∏–¥–∏—Ä–∏—à..." oninput="filterList()"></div>`;
    h+=DATA.map((d,i)=>`<div class="list-card ${learned.has(i)?'done':''}" onclick="goTo(${i})" data-word="${d[0]} ${d[2]}"><div class="num">${i+1}</div><div class="word">${d[0]}</div><div class="meaning">${d[2]}</div></div>`).join("");
    document.getElementById("list").innerHTML=h
}
function filterList(){
    const q=document.getElementById("searchInput").value.toLowerCase();
    document.querySelectorAll(".list-card[data-word]").forEach(el=>{el.style.display=el.dataset.word.toLowerCase().includes(q)?"":"none"})
}
function goTo(i){wordOrder=[...Array(DATA.length).keys()];wordIdx=i;adjIdx=0;mode("learn");render()}
document.addEventListener("keydown",e=>{
    const learnOn=document.getElementById("learn").style.display!=="none";
    const quizOn=document.getElementById("quiz").classList.contains("active");
    if(learnOn){
        if(e.key==="ArrowLeft")prevWord();if(e.key==="ArrowRight")nextWord();
        if(e.key==="1")setAdj(0);if(e.key==="2")setAdj(1);if(e.key==="3")setAdj(2);
        if(e.key===" "){e.preventDefault();markDone()}
    }
    if(quizOn&&quizType==="write"&&e.key==="Enter")checkWrite()
});
let sentScore=0, sentTries=0, currentSentAnswer="";

function genSentence(){
    // SENTENCES massividan tasodifiy gap tanlash
    const sentIdx = Math.floor(Math.random() * SENTENCES.length);
    const sent = SENTENCES[sentIdx];
    const {wI, aI, cI, pl, sentence, answer} = sent;

    const d = DATA[wI];
    if(!d) { console.error("DATA["+wI+"] not found!"); genSentence(); return; }
    const [noun, gender, nUz, nUzPl, adjs] = d;
    if(!adjs || !adjs[aI]) { console.error("adjs["+aI+"] not found for wI="+wI); genSentence(); return; }
    const [adj, adjUz, forms] = adjs[aI];
    const correctForm = answer;

    currentSentAnswer = correctForm;

    const caseName = CASES[cI].ru;
    const numText = pl ? "–º–Ω.—á." : "–µ–¥.—á.";

    // Gap matnini ko'rsatish
    document.getElementById("sentText").innerHTML = sentence.replace("___", '<span class="sent-blank">?</span>');
    document.getElementById("sentHint").innerHTML = `<strong>${adj} ${noun}</strong> ‚Äî ${caseName}, ${numText}`;
    document.getElementById("sentRes").style.display = "none";

    // Noto'g'ri variantlar yaratish - faqat shu so'zning boshqa tuslangan shakllari
    const opts = [correctForm];
    const allForms = [];

    // 1. Xuddi shu sifat, boshqa padejlar (xuddi shu son)
    for(let c=0; c<6; c++){
        if(c === cI) continue;
        const form = forms[pl?1:0][c];
        if(form && form !== "‚Äî" && form !== correctForm && !allForms.includes(form)) allForms.push(form);
    }
    // 2. Xuddi shu sifat, boshqa son
    for(let c=0; c<6; c++){
        const form = forms[pl?0:1][c];
        if(form && form !== "‚Äî" && form !== correctForm && !allForms.includes(form)) allForms.push(form);
    }
    // 3. Agar kam bo'lsa, boshqa sifatlardan ham olish
    if(allForms.length < 2){
        for(let a=0; a<3; a++){
            if(a === aI) continue;
            const otherAdj = adjs[a];
            if(!otherAdj) continue;
            const otherForms = otherAdj[2];
            // Xuddi shu padej va son
            const form = otherForms[pl?1:0][cI];
            if(form && form !== "‚Äî" && form !== correctForm && !allForms.includes(form)) allForms.push(form);
            // Boshqa padejlar
            for(let c=0; c<6; c++){
                if(c === cI) continue;
                const f = otherForms[pl?1:0][c];
                if(f && f !== "‚Äî" && f !== correctForm && !allForms.includes(f)) allForms.push(f);
            }
        }
    }

    // Tasodifiy 2 ta noto'g'ri variant tanlash
    while(opts.length < 3 && allForms.length > 0){
        const i = Math.floor(Math.random() * allForms.length);
        opts.push(allForms.splice(i, 1)[0]);
    }

    // Variantlarni aralashtirish
    for(let i = opts.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [opts[i], opts[j]] = [opts[j], opts[i]];
    }

    document.getElementById("sentOptions").innerHTML = opts.map(o =>
        `<button class="sent-opt" onclick="checkSentence(this,'${o.replace(/'/g,"\\'")}','${correctForm.replace(/'/g,"\\'")}')">${o}</button>`
    ).join("");
}

function checkSentence(btn, sel, corr){
    document.querySelectorAll(".sent-opt").forEach(b => {
        b.disabled = true;
        if(b.textContent === corr) b.classList.add("correct");
    });
    sentTries++;
    const res = document.getElementById("sentRes");

    if(sel === corr){
        sentScore++;
        btn.classList.add("correct");
        res.className = "result ok";
        res.innerHTML = "‚úÖ –¢—û“ì—Ä–∏!";
    } else {
        btn.classList.add("wrong");
        res.className = "result no";
        res.innerHTML = `‚ùå –¢—û“ì—Ä–∏ –∂–∞–≤–æ–±: <div class="answer">${corr}</div>`;
    }
    res.style.display = "block";
    document.getElementById("sentScore").textContent = sentScore;
    document.getElementById("sentTries").textContent = sentTries;

    setTimeout(genSentence, 3000);
}

// ===== VERBS SECTION =====
let verbIdx = 0;
let currentAspect = 'nsv';
let verbMode = 'learn';
let verbQuizType = 'conj';
let verbScore = 0, verbTries = 0;
let currentVerbAnswer = '';

function setVerbMode(m) {
    verbMode = m;
    document.getElementById('vLearn').classList.toggle('active', m === 'learn');
    document.getElementById('vQuiz').classList.toggle('active', m === 'quiz');
    document.getElementById('vSent').classList.toggle('active', m === 'sentences');
    document.getElementById('vList').classList.toggle('active', m === 'list');
    document.getElementById('verbLearn').style.display = m === 'learn' ? 'block' : 'none';
    document.getElementById('verbQuiz').style.display = m === 'quiz' ? 'block' : 'none';
    document.getElementById('verbSentences').style.display = m === 'sentences' ? 'block' : 'none';
    document.getElementById('verbList').style.display = m === 'list' ? 'grid' : 'none';
    if (m === 'learn') renderVerb();
    if (m === 'quiz') genVerbQ();
    if (m === 'sentences') genVerbSentence();
    if (m === 'list') renderVerbList();
}

function setAspect(asp) {
    currentAspect = asp;
    document.getElementById('aspNsv').classList.toggle('active', asp === 'nsv');
    document.getElementById('aspSv').classList.toggle('active', asp === 'sv');
    renderVerb();
}

function renderVerb() {
    const v = VERBS[verbIdx];
    if (!v) return;

    document.getElementById('curVerb').textContent = verbIdx + 1;
    document.getElementById('totalVerbs').textContent = VERBS.length;

    const conj = currentAspect === 'nsv' ? v.nsv_conj : v.sv_conj;
    const verbName = currentAspect === 'nsv' ? v.nsv : v.sv;
    const aspectLabel = currentAspect === 'nsv' ? '–ù–°–í (—Ç—É–≥–∞–ª–ª–∞–Ω–º–∞–≥–∞–Ω)' : '–°–í (—Ç—É–≥–∞–ª–ª–∞–≥–∞–Ω)';

    let html = `
        <div class="card-head">
            <div class="verb-pair">
                <div class="verb-item ${currentAspect === 'nsv' ? 'active' : ''}">
                    <div class="aspect">–ù–°–í</div>
                    <div class="verb">${v.nsv}</div>
                </div>
                <div class="verb-item ${currentAspect === 'sv' ? 'active' : ''}">
                    <div class="aspect">–°–í</div>
                    <div class="verb">${v.sv}</div>
                </div>
            </div>
            <div class="badges">
                <span class="badge uz-badge">üá∫üáø ${v.uz}</span>
                <span class="badge" style="background:rgba(99,102,241,0.5)">${v.group}</span>
            </div>
        </div>
        <div class="cases">
            <div style="text-align:center;padding:12px;color:var(--accent-1);font-weight:600;font-size:1.1em;">
                ${verbName} ‚Äî ${aspectLabel}
            </div>
    `;

    // Conjugation table
    for (let i = 0; i < 6; i++) {
        const present = conj.present ? conj.present[i] : '‚Äî';
        const future = conj.future ? conj.future[i] : '‚Äî';

        html += `
            <div class="conj-row">
                <div class="pronoun">${PRONOUNS[i]}<br><span style="font-size:0.75em;color:var(--text-3)">${PRONOUNS_UZ[i]}</span></div>
                <div class="tense-cell">
                    <div class="lbl">“≤–æ–∑–∏—Ä–≥–∏</div>
                    <div class="form ${present === '‚Äî' ? 'na' : ''}">${present}</div>
                </div>
                <div class="tense-cell">
                    <div class="lbl">–é—Ç–≥–∞–Ω</div>
                    <div class="form">${i < 4 ? conj.past[i] : '‚Äî'}</div>
                </div>
                <div class="tense-cell">
                    <div class="lbl">–ö–µ–ª–∞—Å–∏</div>
                    <div class="form">${future}</div>
                </div>
            </div>
        `;
    }

    html += '</div>';
    document.getElementById('verbCard').innerHTML = html;
}

function prevVerb() { if (verbIdx > 0) { verbIdx--; renderVerb(); } }
function nextVerb() { if (verbIdx < VERBS.length - 1) { verbIdx++; renderVerb(); } }
function goToVerb(n) {
    const num = parseInt(n);
    if (num >= 1 && num <= VERBS.length) { verbIdx = num - 1; renderVerb(); }
}

function renderVerbList() {
    let html = '<div class="search-wrap"><input type="text" class="search-input" id="verbSearchInput" placeholder="üîç “ö–∏–¥–∏—Ä–∏—à..." oninput="filterVerbList()"></div>';
    html += VERBS.map((v, i) => `
        <div class="list-card" onclick="verbIdx=${i};setVerbMode('learn')" data-word="${v.nsv} ${v.sv} ${v.uz}">
            <div class="num">${i + 1}</div>
            <div class="word">${v.nsv} / ${v.sv}</div>
            <div class="meaning">${v.uz}</div>
        </div>
    `).join('');
    document.getElementById('verbList').innerHTML = html;
}

function filterVerbList() {
    const q = document.getElementById('verbSearchInput').value.toLowerCase();
    document.querySelectorAll('#verbList .list-card[data-word]').forEach(el => {
        el.style.display = el.dataset.word.toLowerCase().includes(q) ? '' : 'none';
    });
}

function setVerbQuizType(t) {
    verbQuizType = t;
    document.getElementById('vqConj').classList.toggle('active', t === 'conj');
    document.getElementById('vqUzRu').classList.toggle('active', t === 'uz2ru');
    document.getElementById('vqRuUz').classList.toggle('active', t === 'ru2uz');
    document.getElementById('vWriteMode').style.display = t === 'conj' ? 'block' : 'none';
    document.getElementById('vChoiceMode').style.display = t !== 'conj' ? 'block' : 'none';
    genVerbQ();
}

function genVerbQ() {
    const vI = Math.floor(Math.random() * VERBS.length);
    const v = VERBS[vI];
    const asp = Math.random() > 0.5 ? 'nsv' : 'sv';
    const conj = asp === 'nsv' ? v.nsv_conj : v.sv_conj;
    const verbName = asp === 'nsv' ? v.nsv : v.sv;
    const aspLabel = asp === 'nsv' ? '–ù–°–í' : '–°–í';

    document.getElementById('vqRes').style.display = 'none';

    if (verbQuizType === 'conj') {
        // Random tense and person
        const tenses = ['present', 'past', 'future'];
        let tense, pIdx, form;
        let attempts = 0;
        do {
            tense = tenses[Math.floor(Math.random() * 3)];
            pIdx = tense === 'past' ? Math.floor(Math.random() * 4) : Math.floor(Math.random() * 6);
            form = conj[tense] ? conj[tense][pIdx] : null;
            attempts++;
        } while ((!form || form === '‚Äî') && attempts < 20);

        if (!form || form === '‚Äî') { genVerbQ(); return; }

        currentVerbAnswer = form;
        const tenseNames = { present: '“≤–æ–∑–∏—Ä–≥–∏', past: '–é—Ç–≥–∞–Ω', future: '–ö–µ–ª–∞—Å–∏' };
        const personLabel = tense === 'past' ? PAST_LABELS[pIdx] : PRONOUNS[pIdx];

        document.getElementById('vqWord').textContent = verbName;
        document.getElementById('vqInfo').textContent = `${aspLabel} ‚Äî ${tenseNames[tense]} –∑–∞–º–æ–Ω`;
        document.getElementById('vqHint').textContent = tense === 'past' ? `${personLabel} —Ä–æ–¥` : personLabel;
        document.getElementById('vqHint').style.display = 'inline-block';
        document.getElementById('vqInput').value = '';
        document.getElementById('vqInput').focus();
    } else if (verbQuizType === 'uz2ru') {
        // Uzbek to Russian
        document.getElementById('vqWord').textContent = 'üá∫üáø ' + v.uz;
        document.getElementById('vqInfo').textContent = '–†—É—Å—á–∞ —Ñ–µ—ä–ª–Ω–∏ —Ç–æ–ø–∏–Ω–≥';
        document.getElementById('vqHint').style.display = 'none';
        currentVerbAnswer = v.nsv;

        // Generate options
        const opts = [v.nsv];
        const allVerbs = VERBS.filter((x, i) => i !== vI).map(x => x.nsv);
        while (opts.length < 4 && allVerbs.length > 0) {
            const i = Math.floor(Math.random() * allVerbs.length);
            opts.push(allVerbs.splice(i, 1)[0]);
        }
        shuffleArray(opts);
        document.getElementById('vOptions').innerHTML = opts.map(o =>
            `<button class="opt-btn" onclick="checkVerbOpt(this,'${o.replace(/'/g,"\\'")}','${currentVerbAnswer.replace(/'/g,"\\'")}')">${o}</button>`
        ).join('');
    } else {
        // Russian to Uzbek
        document.getElementById('vqWord').textContent = 'üá∑üá∫ ' + v.nsv + ' / ' + v.sv;
        document.getElementById('vqInfo').textContent = '–é–∑–±–µ–∫—á–∞ —Ç–∞—Ä–∂–∏–º–∞–Ω–∏ —Ç–æ–ø–∏–Ω–≥';
        document.getElementById('vqHint').style.display = 'none';
        currentVerbAnswer = v.uz;

        const opts = [v.uz];
        const allUz = VERBS.filter((x, i) => i !== vI).map(x => x.uz);
        while (opts.length < 4 && allUz.length > 0) {
            const i = Math.floor(Math.random() * allUz.length);
            opts.push(allUz.splice(i, 1)[0]);
        }
        shuffleArray(opts);
        document.getElementById('vOptions').innerHTML = opts.map(o =>
            `<button class="opt-btn" onclick="checkVerbOpt(this,'${o.replace(/'/g,"\\'")}','${currentVerbAnswer.replace(/'/g,"\\'")}')">${o}</button>`
        ).join('');
    }
}

function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

function checkVerbWrite() {
    const user = document.getElementById('vqInput').value.trim().toLowerCase();
    const corr = currentVerbAnswer.toLowerCase();
    verbTries++;
    const res = document.getElementById('vqRes');

    if (user === corr) {
        verbScore++;
        res.className = 'result ok';
        res.innerHTML = '‚úÖ –¢—û“ì—Ä–∏!';
    } else {
        res.className = 'result no';
        res.innerHTML = `‚ùå <div class="answer">${currentVerbAnswer}</div>`;
    }
    res.style.display = 'block';
    document.getElementById('verbScore').textContent = verbScore;
    document.getElementById('verbTries').textContent = verbTries;
    setTimeout(genVerbQ, 3000);
}

function skipVerbQ() {
    const res = document.getElementById('vqRes');
    res.className = 'result no';
    res.innerHTML = `<div class="answer">${currentVerbAnswer}</div>`;
    res.style.display = 'block';
    verbTries++;
    document.getElementById('verbScore').textContent = verbScore;
    document.getElementById('verbTries').textContent = verbTries;
    setTimeout(genVerbQ, 3000);
}

function checkVerbOpt(btn, sel, corr) {
    document.querySelectorAll('#vOptions .opt-btn').forEach(b => {
        b.disabled = true;
        if (b.textContent === corr) b.classList.add('correct');
    });
    verbTries++;
    const res = document.getElementById('vqRes');

    if (sel === corr) {
        verbScore++;
        btn.classList.add('correct');
        res.className = 'result ok';
        res.innerHTML = '‚úÖ –¢—û“ì—Ä–∏!';
    } else {
        btn.classList.add('wrong');
        res.className = 'result no';
        res.innerHTML = `‚ùå <div class="answer">${corr}</div>`;
    }
    res.style.display = 'block';
    document.getElementById('verbScore').textContent = verbScore;
    document.getElementById('verbTries').textContent = verbTries;
    setTimeout(genVerbQ, 3000);
}

// ===== VERB SENTENCES =====
let vSentScore = 0, vSentTries = 0, currentVSentAnswer = '';

function genVerbSentence() {
    const sentIdx = Math.floor(Math.random() * VERB_SENTENCES.length);
    const sent = VERB_SENTENCES[sentIdx];
    const { vI, asp, tense, pIdx, sentence, answer } = sent;

    const v = VERBS[vI];
    if (!v) { genVerbSentence(); return; }

    currentVSentAnswer = answer;

    const verbName = asp === 'nsv' ? v.nsv : v.sv;
    const aspLabel = asp === 'nsv' ? '–ù–°–í' : '–°–í';
    const tenseNames = { present: '“≥–æ–∑–∏—Ä–≥–∏', past: '—û—Ç–≥–∞–Ω', future: '–∫–µ–ª–∞—Å–∏' };
    const personLabel = tense === 'past' ? PAST_LABELS[pIdx] : PRONOUNS[pIdx];

    document.getElementById('vSentText').innerHTML = sentence.replace('___', '<span class="sent-blank">?</span>');
    document.getElementById('vSentHint').innerHTML = `<strong>${verbName}</strong> (${aspLabel}) ‚Äî ${tenseNames[tense]} –∑–∞–º–æ–Ω, ${personLabel}`;
    document.getElementById('vSentRes').style.display = 'none';

    // Generate options from same verb's forms
    const conj = asp === 'nsv' ? v.nsv_conj : v.sv_conj;
    const opts = [answer];
    const allForms = [];

    // Collect other forms from same tense
    if (conj[tense]) {
        conj[tense].forEach((f, i) => {
            if (i !== pIdx && f && f !== '‚Äî' && f !== answer && !allForms.includes(f)) {
                allForms.push(f);
            }
        });
    }

    // Collect forms from other tenses
    ['present', 'past', 'future'].forEach(t => {
        if (t !== tense && conj[t]) {
            conj[t].forEach(f => {
                if (f && f !== '‚Äî' && f !== answer && !allForms.includes(f)) {
                    allForms.push(f);
                }
            });
        }
    });

    // Also add forms from the other aspect
    const otherConj = asp === 'nsv' ? v.sv_conj : v.nsv_conj;
    ['present', 'past', 'future'].forEach(t => {
        if (otherConj[t]) {
            otherConj[t].forEach(f => {
                if (f && f !== '‚Äî' && f !== answer && !allForms.includes(f)) {
                    allForms.push(f);
                }
            });
        }
    });

    // Pick 2 random wrong options
    while (opts.length < 3 && allForms.length > 0) {
        const i = Math.floor(Math.random() * allForms.length);
        opts.push(allForms.splice(i, 1)[0]);
    }

    shuffleArray(opts);

    document.getElementById('vSentOptions').innerHTML = opts.map(o =>
        `<button class="sent-opt" onclick="checkVerbSentence(this,'${o.replace(/'/g,"\\'")}','${currentVSentAnswer.replace(/'/g,"\\'")}')">${o}</button>`
    ).join('');
}

function checkVerbSentence(btn, sel, corr) {
    document.querySelectorAll('#vSentOptions .sent-opt').forEach(b => {
        b.disabled = true;
        if (b.textContent === corr) b.classList.add('correct');
    });
    vSentTries++;
    const res = document.getElementById('vSentRes');

    if (sel === corr) {
        vSentScore++;
        btn.classList.add('correct');
        res.className = 'result ok';
        res.innerHTML = '‚úÖ –¢—û“ì—Ä–∏!';
    } else {
        btn.classList.add('wrong');
        res.className = 'result no';
        res.innerHTML = `‚ùå –¢—û“ì—Ä–∏ –∂–∞–≤–æ–±: <div class="answer">${corr}</div>`;
    }
    res.style.display = 'block';
    document.getElementById('vSentScore').textContent = vSentScore;
    document.getElementById('vSentTries').textContent = vSentTries;

    setTimeout(genVerbSentence, 3000);
}

// Keyboard for verbs
document.addEventListener('keydown', e => {
    const verbsOn = document.getElementById('verbs').classList.contains('active');
    if (verbsOn && verbMode === 'learn') {
        if (e.key === 'ArrowLeft') prevVerb();
        if (e.key === 'ArrowRight') nextVerb();
        if (e.key === 'n' || e.key === 'N') setAspect('nsv');
        if (e.key === 's' || e.key === 'S') setAspect('sv');
    }
    if (verbsOn && verbMode === 'quiz' && verbQuizType === 'conj' && e.key === 'Enter') checkVerbWrite();
});

// ========== GRAMMAR SECTION ==========
let currentCaseIdx = 0;

function renderGrammar() {
    // Build tabs
    let tabs = '';
    GRAMMAR_CASES.forEach((c, i) => {
        tabs += `<button class="gram-tab${i === currentCaseIdx ? ' active' : ''}" onclick="setGramCase(${i})">${c.id}. ${c.name.slice(0, 3)}.</button>`;
    });
    document.getElementById('gramTabs').innerHTML = tabs;
    renderGramCase();
}

function setGramCase(idx) {
    if (idx < 0 || idx >= GRAMMAR_CASES.length) return;
    currentCaseIdx = idx;
    document.querySelectorAll('.gram-tab').forEach((t, i) => t.classList.toggle('active', i === idx));
    renderGramCase();
    window.scrollTo({ top: document.getElementById('grammar').offsetTop - 60, behavior: 'smooth' });
}

function renderGramCase() {
    const c = GRAMMAR_CASES[currentCaseIdx];
    let h = '';

    // Header
    h += `<div class="gram-header">
        <div class="gram-header-top" style="background:linear-gradient(135deg,${c.color},${c.color}cc)">
            <div class="gram-case-name">${c.id}. ${c.name} –ø–∞–¥–µ–∂</div>
            <div class="gram-case-question">${c.question}</div>
            <div class="gram-case-uz">${c.nameUz} ‚Äî ${c.questionUz}</div>
        </div>
        <div class="gram-header-body">
            <div class="gram-explanation">
                <h3>–ù–∏–º–∞ —É—á—É–Ω –∏—à–ª–∞—Ç–∏–ª–∞–¥–∏?</h3>
                <p>${c.explanation.ru}</p>
                <p class="uz-text">${c.explanation.uz}</p>
            </div>
        </div>
    </div>`;

    // When to use
    h += `<div class="gram-section"><h3>“ö–∞—á–æ–Ω –∏—à–ª–∞—Ç–∞–º–∏–∑?</h3>`;
    c.whenToUse.forEach(u => {
        const ruHl = u.example.highlight ? u.example.ru.replace(u.example.highlight, `<span class="hl">${u.example.highlight}</span>`) : u.example.ru;
        h += `<div class="use-case-item">
            <div class="use-case-title">${u.ru}</div>
            <div class="use-case-title-uz">${u.uz}</div>
            <div class="use-case-example">
                <div class="ru">${ruHl}</div>
                <div class="uz">${u.example.uz}</div>
            </div>
        </div>`;
    });
    h += `</div>`;

    // Noun endings table
    h += `<div class="gram-section"><h3>–û—Ç “õ—û—à–∏–º—á–∞–ª–∞—Ä–∏ (–û–∫–æ–Ω—á–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö)</h3>`;
    const genders = [
        { key: 'masculine', label: '–ú—É–∂—Å–∫–æ–π', badge: '–º', cls: 'g-m' },
        { key: 'feminine', label: '–ñ–µ–Ω—Å–∫–∏–π', badge: '–∂', cls: 'g-f' },
        { key: 'neuter', label: '–°—Ä–µ–¥–Ω–∏–π', badge: '—Å—Ä', cls: 'g-n' }
    ];
    genders.forEach(g => {
        const e = c.endings[g.key];
        const examplesHtml = e.examples.map(ex => `${ex.sg} ‚Üí ${ex.pl}`).join('<br>');
        h += `<div class="ending-row">
            <div class="ending-gender"><span class="badge ${g.cls}">${g.badge}</span>${g.label}</div>
            <div class="ending-cell">
                <div class="lbl">–ë–∏—Ä–ª–∏–∫ (–µ–¥.—á.)</div>
                <div class="val">${e.singular || '‚Äî'}</div>
                <div class="exs">${e.examples.map(ex => ex.sg).join(', ')}</div>
            </div>
            <div class="ending-cell">
                <div class="lbl">–ö—û–ø–ª–∏–∫ (–º–Ω.—á.)</div>
                <div class="val">${e.plural || '‚Äî'}</div>
                <div class="exs">${e.examples.map(ex => ex.pl).join(', ')}</div>
            </div>
        </div>`;
    });

    // Adjective endings
    if (c.adjEndings) {
        h += `<div class="adj-ending-section"><h4>–°–∏—Ñ–∞—Ç “õ—û—à–∏–º—á–∞–ª–∞—Ä–∏ (–û–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö)</h4>`;
        genders.forEach(g => {
            const a = c.adjEndings[g.key];
            h += `<div class="ending-row">
                <div class="ending-gender"><span class="badge ${g.cls}">${g.badge}</span>${g.label}</div>
                <div class="ending-cell">
                    <div class="lbl">–ë–∏—Ä–ª–∏–∫ (–µ–¥.—á.)</div>
                    <div class="val">${a.sg}</div>
                    <div class="exs">${a.example.sg}</div>
                </div>
                <div class="ending-cell">
                    <div class="lbl">–ö—û–ø–ª–∏–∫ (–º–Ω.—á.)</div>
                    <div class="val">${a.pl}</div>
                    <div class="exs">${a.example.pl}</div>
                </div>
            </div>`;
        });
        h += `</div>`;
    }
    h += `</div>`;

    // Examples
    h += `<div class="gram-section"><h3>–ú–∏—Å–æ–ª–ª–∞—Ä</h3><div class="examples-grid">`;
    c.examples.forEach(ex => {
        const ruHl = ex.highlight ? ex.ru.replace(ex.highlight, `<span class="hl">${ex.highlight}</span>`) : ex.ru;
        h += `<div class="example-card"><div class="ru">${ruHl}</div><div class="uz">${ex.uz}</div></div>`;
    });
    h += `</div></div>`;

    // Common mistakes
    if (c.commonMistakes && c.commonMistakes.length) {
        h += `<div class="gram-section"><h3>–ö—û–ø —É—á—Ä–∞–π–¥–∏–≥–∞–Ω —Ö–∞—Ç–æ–ª–∞—Ä</h3>`;
        c.commonMistakes.forEach(m => {
            h += `<div class="mistake-item">
                <div class="mistake-wrong">${m.wrong}</div>
                <div class="mistake-correct">${m.correct}</div>
                <div class="mistake-explain">${m.explanation.ru}<span class="uz-text">${m.explanation.uz}</span></div>
            </div>`;
        });
        h += `</div>`;
    }

    document.getElementById('gramContent').innerHTML = h;

    // Update nav buttons
    document.getElementById('gramPrev').disabled = currentCaseIdx === 0;
    document.getElementById('gramNext').disabled = currentCaseIdx === GRAMMAR_CASES.length - 1;
}

function prevCase() { if (currentCaseIdx > 0) setGramCase(currentCaseIdx - 1); }
function nextCase() { if (currentCaseIdx < GRAMMAR_CASES.length - 1) setGramCase(currentCaseIdx + 1); }

render();updateStats()
</script>
</body>
</html>
